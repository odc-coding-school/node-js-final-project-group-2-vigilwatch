<!-- This is the dashboard page -->

<!-- This is the dashboard page -->
<%- include('layouts/header')%>
<link rel="stylesheet" href="/css/dashboard.css">
<title>Dashboard</title>
<script src="/socket.io/socket.io.js"></script>
</head>
<body>
<header>
  <%- include ('layouts/navbar')%>
  <%- include ('layouts/sidebar')%>
</header>

<!-- Dashboard.ejs -->
<div class="dashboard-container">
    <div class="profile-section">
        <img src="<%= userProfile %>" alt="User Profile">
    </div>

    <h2 style="text-align: center;">Incident Reports for Your Location</h2>
    <div class="incidents-section">
        <% if (allIncidents.length > 0) { %>
            <% allIncidents.forEach(incident => { %>
                <div class="incident-card shadow-lg">
                    <h3>Incident: <%= incident.incident_type %></h3>
                    <p>Location: <%= incident.location %></p>
                    <div class="tooltip-wrapper">
                        <span style="color: #666;">
                           Reported by: <%= incident.name %>
                        </span>
                        <div class="tooltip-box">
                            <div class="hover-item">
                                <img src="data:image/png;base64,<%= incident.profile_picture %>" alt="Profile Picture" id="profile">
                                <div class="info">
                                    <div id="name"><strong><%= incident.name %></strong></div>
                                    <div id="description">"<%= incident.description %>"</div>
                                </div>
                            </div>
                    
                           
                    
                            <div class="contact">
                                <!-- Contact button with a dropdown -->
                                <div class="btn-group">
                                    <button class="btn btn-primary dropdown-toggle" type="button" id="contactDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                        <i class="fas fa-user"></i> Contact
                                    </button>
                                    <ul class="dropdown-menu" aria-labelledby="contactDropdown">
                                        <li><a class="dropdown-item" href="tel:<%= incident.phone %>">Call</a></li>
                                        <li><a class="dropdown-item" href="mailto:<%= incident.email %>">Email</a></li>
                                        <li><a class="dropdown-item" href="sms:<%= incident.phone %>">Send SMS</a></li>
                                    </ul>
                                </div>
                                
                            
                                <!-- Private Message button -->
                                <button class="btn btn-primary"><i class="fas fa-message"></i> Private Message</button>
                            </div>
                            
                        </div>
                    </div>
                    
                    
                    
                    
                    <p><a href="mailto: <%= incident.email %>"><%= incident.email %></a> ( <a href="tel: <%= incident.phone %>"><%= incident.phone %></a>)</p>

                    <p>Time: <%= incident.formatted_time %></p>
                    <p>Date: <%= incident.formatted_date %></p>
                    <% if (incident.imageSrcs && incident.imageSrcs.length > 0) { %>
                        <div class="incident-images">
                            <% incident.imageSrcs.forEach(src => { %>
                                <img src="<%= src %>" alt="Incident Image">
                            <% }) %>
                        </div>
                    <% } %>
                </div>
                <% }) %>
                <% } else { %>
                    <p>No incidents reported for your location.</p>
                    <% } %>
                </div>

                
            </div>
            <script>
                const socket = io(); // Establishing the connection
        
                // Listen for new notifications
                socket.on('new_notification', (data) => {
                    const audio = new Audio('/sounds/notification-sound.mp3');
                    audio.play();
                    alert(`You have a new notification from: ${data.incident_type} Incident Reported - ${data.description}`);
                });
            </script>      
            
<script>
 // Activate Bootstrap 5 tooltips
document.addEventListener('DOMContentLoaded', function () {
    const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    tooltipTriggerList.forEach(function (tooltipTriggerEl) {
        new bootstrap.Tooltip(tooltipTriggerEl);
    });
});


</script>



<%- include('layouts/footer')%>


